## GC는 어떻게 victim을 결정하나

GC는 가비지컬렉션으로 자바스크립트에서 더 이상 사용하지 않는 메모리를 결정해 사용할 수 있게끔 관리한다. 하지만 어느 객체가 더 이상 사용되지 않는지 알기는 사실상 불가능하기 때문에! (미래를 어떻게 아냐구요~) 여러가지 방법에 의해 victim을 결정한다.

### 1. 참조 횟수 계산 가비지 컬렉션

- 간단히 해당 객체에 대한 참조가 하나도 없는 경우 가비지 컬렉션의 대상이 된다.
- 하지만, 순환 참조 문제의 경우 GC의 대상이 될 수 없다.

```jsx
function f() {
  var o1 = {};
  var o2 = {};
  o1.p = o2; // o1은 o2를 참조함
  o2.p = o1; // o2는 o1을 참조함. 이를 통해 순환 참조가 만들어짐.
}
f();
// 외부에서 o1, o2에 대한 참조는 없지만 서로 참조하기 때문에 참조 횟수가 1이 아님
```

### 2. 마크스위프 알고리즘

- Mark and Sweep Algorithm

1. 가비지컬렉터는 모든 루트(전역 변수)의 완전한 목록을 만들어냅니다. (트리)
2. 활성화 여부를 표시합니다. 루트가 닿을 수 없는 것들은 가비지로 표시됩니다.
3. 비활성 메모리를 OS에 반환합니다.

![1_WVtok3BV0NgU95mpxk9CNg.gif](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3debfb2d-f9bf-4326-b094-4ef72bcf8ae5/1_WVtok3BV0NgU95mpxk9CNg.gif)

- 순환참조 문제는 해결
- 주로 메모리를 할당할 때 가비지컬렉터가 가비지컬렉션을 넘겨준다.
- 만약 할당을 하지 않는다면? → 가비지가 매우 큰데, 할당이 안일어나서 반환이 안일어난다. → 메모리 누수는 아니지만, 메모리를 크게 낭비하고 있다!
